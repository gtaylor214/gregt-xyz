<!-- 1. DATA LOGIC -->
<!-- Check where the cartridge data is located (Page vs Section vs Passed Variable) -->
{% if cartridges %}
    {% set _carts = cartridges %}
{% elif section.extra.cartridges %}
    {% set _carts = section.extra.cartridges %}
{% elif page.extra.cartridges %}
    {% set _carts = page.extra.cartridges %}
{% else %}
    {% set _carts = [] %}
{% endif %}

<!-- Check for visual overrides -->
{% if overrides %}
    {% set _ov = overrides %}
{% elif section.extra.deck_overrides %}
    {% set _ov = section.extra.deck_overrides %}
{% elif page.extra.deck_overrides %}
    {% set _ov = page.extra.deck_overrides %}
{% endif %}

<!-- 2. COMPONENT MARKUP -->
<main id="net-deck" style="
    {% if _ov %}
        {% if _ov.body_color %}--gunmetal: {{ _ov.body_color }};{% endif %}
        {% if _ov.screen_color %}--phosphor: {{ _ov.screen_color }};{% endif %}
        {% if _ov.accent_color %}--amber: {{ _ov.accent_color }};{% endif %}
        {% if _ov.scale %}transform: scale({{ _ov.scale }});{% endif %}
    {% endif %}
">
    
    <!-- SCREEN SECTION -->
    <section id="viewport">
        <div class="monitor-frame">
            <div class="crt-glass">
                <canvas id="wasm-canvas"></canvas>

                <div class="terminal-interface">
                    <div class="header-group">
                        <div class="os-info">
                            {% if _ov and _ov.os_name %}{{ _ov.os_name }}{% else %}GUNMETAL_OS_v5{% endif %}
                        </div>
                        <div class="stats-cluster">
                            <div class="sys-time">SYS_READY</div>
                            <div class="fps-counter">60HZ</div>
                        </div>
                    </div>
                    
                    <div class="command-group">
                        <p class="log">> SYSTEM_READY</p>
                        <div class="active-line">
                            <span class="typing">> INSERT_CARTRIDGE</span><span class="cursor">_</span>
                        </div>
                    </div>
                </div>

                <!-- FX -->
                <div class="scanlines" aria-hidden="true"></div>
                <div class="crt-glow" aria-hidden="true"></div>
                <div class="screen-curve-overlay" aria-hidden="true"></div>
            </div>
        </div>
    </section>

    <!-- DRIVE BAY SECTION -->
    <aside id="modular-bay">
        <div class="bay-header">EXPANSION_PORT_A</div>

        <!-- Cartridge Loop -->
        {% if _carts | length > 0 %}
            {% for cart in _carts %}
            <div class="drive-slot">
                <input type="radio" 
                       name="deck-state" 
                       id="{{ cart.id }}" 
                       class="deck-logic" 
                       value="{{ cart.value }}">
                
                <label for="{{ cart.id }}" class="program-cart">
                    <div class="grip-patch">
                        <span class="grip-line"></span>
                        <span class="grip-line"></span>
                        <span class="grip-line"></span>
                    </div>
                    <div class="cart-label">{{ cart.label }}</div>
                    <div class="indicator-group"><div class="led"></div></div>
                </label>
            </div>
            {% endfor %}
        {% else %}
             <div class="drive-slot"><div class="cart-label">ERR: NO_DATA</div></div>
        {% endif %}

        <!-- Static Eject -->
        <div class="controls-area">
            <input type="radio" name="deck-state" id="eject" class="deck-logic" value="eject" checked>
            <label for="eject" class="eject-btn">/// MANUAL_EJECT ///</label>
        </div>
    </aside>
</main>